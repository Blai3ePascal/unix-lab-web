<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Laboratorio UNIX - UCM</title>
    <script src="./libv86.js"></script>
    <style>
        body { margin: 0; background: #050505; color: #0f0; font-family: 'Consolas', monospace; overflow: hidden; }
        #screen_container { width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        canvas { background: #000; border: 1px solid #333; }
        #sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: 280px; background: rgba(0, 15, 0, 0.95); border-right: 2px solid #0f0; padding: 20px; transform: translateX(-100%); transition: transform 0.3s; z-index: 1000; display: flex; flex-direction: column; gap: 15px; }
        #sidebar.visible { transform: translateX(0); }
        h3 { border-bottom: 1px dashed #0f0; padding-bottom: 10px; text-align: center; }
        button { background: #000; color: #0f0; border: 1px solid #005500; padding: 10px; cursor: pointer; width: 100%; text-align: left; margin-bottom: 5px; }
        button:hover { background: #0f0; color: #000; }
        #menu-btn { position: fixed; left: 20px; top: 20px; z-index: 1001; background: #000; border: 1px solid #0f0; color: #0f0; padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>
    <button id="menu-btn" onclick="document.getElementById('sidebar').classList.toggle('visible')">[+] MENU</button>
    <div id="sidebar">
        <h3>:: SISTEMA UCM ::</h3>
        <button onclick="requestFullScreen()">Pantalla Completa</button>
        <button onclick="takeScreenshot()">Captura Pantalla</button>
        <button onclick="location.reload()" style="color:red; border-color:red">REINICIAR</button>
    </div>
    <div id="screen_container">
        <div id="screen"></div>
    </div>

    <script>
        "use strict";
        
        window.onload = function() {
            // VERIFICACIÓN DE SEGURIDAD
            if (typeof V86Starter === "undefined") {
                alert("ERROR CRÍTICO: No se encuentra 'libv86.js'.\nAsegúrate de que el archivo está en la misma carpeta que index.html en GitHub.");
                return;
            }

            var emulator = new V86Starter({
                wasm_path: "./v86.wasm",
                memory_size: 256 * 1024 * 1024,
                vga_memory_size: 8 * 1024 * 1024,
                screen_container: document.getElementById("screen"),
                bios: { url: "./seabios.bin" },
                vga_bios: { url: "./vgabios.bin" },
                hda: { 
                    url: "./disco.img.gz",
                    async: true,
                    size: 2 * 1024 * 1024 * 1024
                },
                autostart: true
            });
        };

        function requestFullScreen() {
            var el = document.documentElement;
            if (el.requestFullscreen) el.requestFullscreen();
        }
        function takeScreenshot() {
             var canvas = document.querySelector("canvas");
             if(canvas) {
                 var a = document.createElement("a");
                 a.download = "Captura-UCM.png";
                 a.href = canvas.toDataURL();
                 a.click();
             }
        }
    </script>
</body>
</html>