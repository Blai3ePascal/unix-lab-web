<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Laboratorio UNIX - UCM</title>
    
    <script src="https://unpkg.com/v86@latest/build/libv86.js"></script>
    
    <style>
        body { margin: 0; background: #050505; color: #0f0; font-family: 'Consolas', monospace; overflow: hidden; }
        #screen_container { width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        canvas { background: #000; border: 1px solid #333; box-shadow: 0 0 30px rgba(0,255,0,0.2); }
        
        #sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: 280px; background: rgba(0, 15, 0, 0.95); border-right: 2px solid #0f0; padding: 20px; transform: translateX(-100%); transition: transform 0.3s; z-index: 1000; display: flex; flex-direction: column; gap: 15px; }
        #sidebar.visible { transform: translateX(0); }
        
        button { background: #000; color: #0f0; border: 1px solid #005500; padding: 12px; cursor: pointer; text-align: left; width: 100%; margin-bottom: 5px; font-family: inherit; }
        button:hover { background: #0f0; color: #000; }
        #menu-btn { position: fixed; left: 20px; top: 20px; z-index: 1001; background: #000; border: 1px solid #0f0; color: #0f0; padding: 8px 15px; cursor: pointer; font-weight: bold; }
        
        .note { font-size: 0.8em; color: #aaa; border: 1px solid #333; padding: 10px; background: #111; }
        #timer-box { margin-top: auto; text-align: center; border-top: 1px dashed #444; padding-top: 15px; color: #fff; font-size: 1.2em;}
    </style>
</head>
<body>
    <button id="menu-btn" onclick="document.getElementById('sidebar').classList.toggle('visible')">[+] MENU</button>

    <div id="sidebar">
        <h3 style="text-align:center; border-bottom:1px dashed #0f0; padding-bottom:10px;">:: SISTEMA UCM ::</h3>
        <button onclick="requestFullScreen()">[ ] Pantalla Completa</button>
        <button onclick="takeScreenshot()">üì∑ Captura Pantalla</button>
        <button onclick="hardReset()" style="color:#ff5555; border-color:#ff5555">‚ö†Ô∏è REINICIAR</button>
        
        <div class="note">
            ‚ÑπÔ∏è <b>INFO:</b> Sistema aislado.<br>
            Usa el bot√≥n de captura para guardar evidencias.
        </div>
        
        <div id="timer-box">
            TIEMPO: <span id="time-left">--:--</span>
        </div>
    </div>

    <div id="screen_container">
        <div id="screen"></div>
    </div>

    <script>
        "use strict";

        window.onload = function() {
            // VERIFICACI√ìN DE CARGA
            if (typeof V86Starter === "undefined") {
                alert("ERROR DE RED: El navegador no ha podido cargar el motor v86 desde unpkg.com.\nComprueba si tienes un bloqueador de anuncios activado.");
                return;
            }

            var emulator = new V86Starter({
                // 1. MOTOR Y BIOS DESDE LA NUBE (UNPKG)
                wasm_path: "https://unpkg.com/v86@latest/build/v86.wasm",
                bios: { url: "https://unpkg.com/v86@latest/bios/seabios.bin" },
                vga_bios: { url: "https://unpkg.com/v86@latest/bios/vgabios.bin" },

                // 2. DISCO DURO LOCAL (TU ARCHIVO)
                // Aseg√∫rate de que en GitHub se llame EXACTAMENTE "disco.img.gz"
                hda: { 
                    url: "disco.img.gz", 
                    async: true,
                    size: 2 * 1024 * 1024 * 1024 
                },
                
                memory_size: 256 * 1024 * 1024,
                vga_memory_size: 8 * 1024 * 1024,
                screen_container: document.getElementById("screen"),
                autostart: true
            });
        };

        function requestFullScreen() {
            var el = document.documentElement;
            if (el.requestFullscreen) el.requestFullscreen();
        }
        function takeScreenshot() {
             var canvas = document.querySelector("canvas");
             if(canvas) {
                 var a = document.createElement("a");
                 a.download = "Captura-UCM.png"; a.href = canvas.toDataURL(); a.click();
             }
        }
        function hardReset() {
            if(confirm("¬øReiniciar sistema?")) location.reload();
        }
        
        setInterval(function() {
            var d = new Date();
            document.getElementById("time-left").innerText = d.toLocaleTimeString();
        }, 1000);
    </script>
</body>
</html>